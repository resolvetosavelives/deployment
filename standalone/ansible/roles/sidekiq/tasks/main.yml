---
- name: Sidekiq | Copy sidekiq monit file
  template:
    src: etc/monit/conf-available/sidekiq.monitrc
    dest: /etc/monit/conf-available/sidekiq.monitrc
  become: true
  notify: restart monit

- name: Sidekiq | enable monit for sidekiq
  file: >
    state=link
    src=/etc/monit/conf-available/sidekiq.monitrc
    dest=/etc/monit/conf-enabled/sidekiq.monitrc
  become: true
  notify: restart monit

- name: Sidekiq | reload monit
  shell: monit reload
  become: true

- name: Sidekiq | restart sidekiq
  monit:
    name: "{{ sidekiq_service_name }}"
    state: restarted
  tags: restart-sidekiq
  become: true
